<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
	
<mapper namespace="com.cinemabox.dao.user.UserDao">

	<select id="getUserById" parameterType="string" resultType="com.cinemabox.vo.User">
		select
			user_id 			as id, 
			user_password 		as password, 
			user_name 			as name, 
			user_email 			as email, 
			user_phone_number 	as phone, 
			user_birth 			as birth, 
			user_created_date 	as createdDate, 
			user_deleted_date 	as deletedDate, 
			user_lock_date 		as lockDate, 
			user_point 			as point, 
			user_status 		as status, 
			coupon_no 			as CouponNo, 
			wishlist_no 		as wishNo, 
			user_role_type 		as roleType, 
			grade_no 			as gradeNo, 
			user_iskakao		as isKakao 
	
		from
			cinemabox_users
		where
			user_id = #{value}
	</select>
	
	<select id="getUserByEmail" parameterType="string" resultType="com.cinemabox.vo.User">
		select
			user_id 			as id, 
			user_password 		as password, 
			user_name 			as name, 
			user_email 			as email, 
			user_phone_number 	as phone, 
			user_birth 			as birth, 
			user_created_date 	as createdDate, 
			user_deleted_date 	as deletedDate, 
			user_lock_date 		as lockDate, 
			user_point 			as point, 
			user_status 		as status, 
			coupon_no 			as CouponNo, 
			wishlist_no 		as wishNo, 
			user_role_type 		as roleType, 
			grade_no 			as gradeNo, 
			user_iskakao		as isKakao 
			
		from
			cinemabox_users
		where
			user_email = #{value}
	</select>
	
	<select id="getwishListById" parameterType="string" resultType="com.cinemabox.dto.user.UserDto">
		select 
       		W.wishlist_no as wishlistNo, 
       		M.movie_no as movieNo,
       		M.movie_thumbnail as movieThumbnail, 
       		M.movie_title as movieTitle, 
       		W.wishlist_created_date as wishlistCreatedDate
       		
		from 
			cinemabox_wishlists W , cinemabox_movie M
		where 
			W.movie_no = M.movie_no
			and
			W.user_id = #{value} 
	</select>
	
	<insert id="insertUser" parameterType="com.cinemabox.vo.User">
		insert into cinemabox_users
		(user_id, user_password, user_name, user_email, user_birth, user_phone_number)
		values
		(#{id}, #{password}, #{name}, #{email}, TO_DATE(#{birth},'YYYY-MM-DD'), #{phone})
	</insert>
	
	<select id="countWishlists" parameterType="com.cinemabox.vo.Wishlist" resultType="int">
		select 
			count(*) 
		from 
			CINEMABOX_WISHLISTS
		where 
			user_id=#{value}
	</select>
</mapper>